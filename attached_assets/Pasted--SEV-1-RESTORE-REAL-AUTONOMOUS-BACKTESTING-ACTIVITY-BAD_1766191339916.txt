ğŸš¨ SEV-1: RESTORE REAL AUTONOMOUS BACKTESTING + ACTIVITY BADGES (NO NEW UI)

This is urgent. The system is not meeting institutional standards yet.
Do not argue semantics. Do not introduce new UI panels.
Fix the backend truth â†’ reflect it with badges only, exactly like before.

ğŸ”´ CORE PROBLEMS (FACTS, NOT OPINIONS)

Bots ARE completing jobs too fast

Backtests complete in seconds

PnL values look impossible

This strongly suggests:

Wrong instrument

Too small data window

Cached bars

Stubbed execution logic

Or incorrect tick / multiplier usage

Badges do NOT appear

User wants inline badges on bot rows

NOT a separate window

NOT a new panel

NOT â€œproof endpointsâ€ as UI

EXACTLY the old behavior from Lovable:

Purple â€œBacktesting Ã—N â€¢ elapsedâ€

Blue â€œImproving #N â€¢ elapsedâ€

Queued badges when waiting

PnL is polluted

Old runs + new runs mixed

Metrics reset is REQUIRED

No trust until reset + re-run with proof

System health is misleading

Autonomy stops ticking when workflow restarts

Health summary previously read wrong table

We need continuous proof, not â€œit ran onceâ€

ğŸ§  NON-NEGOTIABLE GOALS

We are building an institutional-grade autonomous trading system.

That means:

Every backtest must prove:

Correct instrument

Correct tick size

Correct contract multiplier

Realistic bar count

Real execution loop

Activity must be visible inline via badges

Autonomy must run without manual triggers

PnL must be reset and rebuilt cleanly

âœ… REQUIRED ACTIONS (DO THESE IN ORDER)
PHASE 1 â€” FULL METRICS RESET (MANDATORY)

Run this first so nothing is polluted:

curl -X POST http://localhost:5000/api/admin/reset-metrics \
  -H "Content-Type: application/json" \
  -H "X-Admin-Token: dev-admin-secret" \
  -d '{
    "dryRun": false,
    "scope": "ALL",
    "reasonCode": "INSTITUTIONAL_RESET_REQUIRED"
  }' | jq .


Expected outcome:

All bots have zero effective PnL

All future backtests must occur AFTER this timestamp

Old data is ignored entirely

PHASE 2 â€” AUTONOMY MUST QUEUE REAL WORK

Autonomy loop MUST:

Detect bots with no completed backtest after metrics_reset_at

Queue baseline backtests automatically

Then queue improvement iterations

Respect stage locks for promotion ONLY (not testing)

PROOF REQUIRED

Run and paste output:

curl -s http://localhost:5000/api/_proof/autonomy | jq .
curl -s http://localhost:5000/api/_proof/jobs | jq .


We expect:

Autonomy ticks every ~3 minutes

jobs_enqueued > 0 when bots need work

No silent stalls

PHASE 3 â€” BADGES (NO NEW UI, NO PANELS)

ğŸš« DO NOT create a separate activity window
ğŸš« DO NOT hide activity in tooltips
ğŸš« DO NOT invent new semantics

âœ… EXACT BADGE RULES (HARD REQUIREMENT)

Primary badge = activity, not freshness.

Badges must appear inline on the bot row, exactly like Lovable.

SHOW THESE BADGES:

Backtesting Ã—{attempt} â€¢ {elapsed}

Improving #{iteration} â€¢ {elapsed}

Evolving â€¢ {elapsed}

Queued Ã—{attempt}

IMPORTANT BEHAVIOR CHANGE (THIS IS WHY BADGES ARE MISSING NOW)

If a job runs and completes quickly, the badge MUST persist until replaced by the next state.

Do NOT rely on job.status === RUNNING only.

Use:

last_job_started_at

last_job_completed_at

botNow.activeJob

short-term activity memory (minutes, not milliseconds)

If a bot ran a backtest 30 seconds ago, SHOW THE BADGE.

PHASE 4 â€” DELETE ANY â€œFRESH / DATA FRESHâ€ LOGIC

User does NOT want:

â€œData Freshâ€

â€œFresh Dataâ€

â€œRecency pillsâ€

â€œCompleted X agoâ€ badges

ONLY show:

Activity badges (Backtesting / Improving / Queued)

Optional subtle â€œNewâ€ pill for bots <10 minutes old with no history

HARD PROOF REQUIRED

Run and paste:

grep -R "Fresh" -n client server shared || true
grep -R "dataFresh" -n client server shared || true


There must be no rendering path that can show a â€œfreshâ€ badge.

PHASE 5 â€” PROVE BACKTESTS ARE REAL

This is critical. No guessing.

Run and paste results:

-- Instrument correctness
SELECT
  bot_id,
  instrument,
  tick_size,
  contract_multiplier
FROM backtest_sessions
ORDER BY completed_at DESC
LIMIT 10;

-- Bar count + duration realism
SELECT
  bot_id,
  bars_tested,
  started_at,
  completed_at,
  EXTRACT(EPOCH FROM (completed_at - started_at)) AS seconds
FROM backtest_sessions
ORDER BY completed_at DESC
LIMIT 10;

-- Iteration proof (actual improvement)
SELECT
  bot_id,
  iteration,
  params_hash,
  completed_at
FROM backtest_sessions
ORDER BY completed_at DESC
LIMIT 20;


ğŸš¨ RED FLAGS:

Wrong instrument vs bot config

<1000 bars tested

Params hash never changing

Backtests finishing unrealistically fast

ğŸ¯ FINAL ACCEPTANCE CRITERIA

This is considered DONE only when:

âœ… Bots show purple/blue badges inline
âœ… Badges persist long enough to be seen
âœ… PnL was reset and rebuilt cleanly
âœ… Backtests use correct instruments
âœ… Autonomy queues work continuously
âœ… No â€œData Freshâ€ badge exists anywhere
âœ… Proof screenshots + logs are provided

âš ï¸ IMPORTANT

Do not say:

â€œIt already worksâ€

â€œWe donâ€™t see the badgeâ€

â€œItâ€™s a cache issueâ€

The user sees the issue in the UI.
Fix the system so it cannot fail silently again.